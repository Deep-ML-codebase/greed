"use strict";(this.webpackChunkGreed=this.webpackChunkGreed||[]).push([[114],{123:(t,e,i)=>{i.d(e,{A:()=>s});const s=class{constructor(){this._events=new Map,this._maxListeners=10}on(t,e){if("function"!=typeof e)throw new TypeError("Listener must be a function");this._events.has(t)||this._events.set(t,[]);const i=this._events.get(t);return i.push(e),i.length>this._maxListeners&&this.emit("maxListenersExceeded",{event:t,count:i.length,limit:this._maxListeners}),this}once(t,e){const i=(...s)=>{e.apply(this,s),this.off(t,i)};return this.on(t,i)}off(t,e){if(!this._events.has(t))return this;const i=this._events.get(t),s=i.indexOf(e);return-1!==s&&i.splice(s,1),0===i.length&&this._events.delete(t),this}emit(t,...e){if(!this._events.has(t))return!1;const i=this._events.get(t).slice();for(const s of i)try{s.apply(this,e)}catch(e){this.emit("error",e,t)}return!0}removeAllListeners(t){return t?this._events.delete(t):this._events.clear(),this}listenerCount(t){return this._events.has(t)?this._events.get(t).length:0}setMaxListeners(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError("n must be a non-negative number");return this._maxListeners=t,this}eventNames(){return Array.from(this._events.keys())}async emitAsync(t,...e){if(!this._events.has(t))return[];const i=this._events.get(t).slice().map(async i=>{try{return await i.apply(this,e)}catch(e){throw this.emit("error",e,t),e}});return Promise.allSettled(i)}}},777:(t,e,i)=>{i.d(e,{default:()=>y});var s=i(123);class a extends s.A{constructor(t={}){super(),this.config={pyodideIndexURL:t.pyodideIndexURL||"https://cdn.jsdelivr.net/pyodide/v0.24.1/full/",preloadPackages:t.preloadPackages||["numpy"],availablePackages:t.availablePackages||["numpy","scipy","matplotlib","pandas","scikit-learn","plotly","seaborn","statsmodels","sympy","networkx"],timeout:t.initTimeout||3e4,...t},this.pyodide=null,this.isReady=!1,this.installedPackages=new Set,this.initPromise=null}async initialize(){return this.initPromise||(this.initPromise=this._initializeInternal()),this.initPromise}async _initializeInternal(){try{if(this.emit("init:start",{stage:"pyodide"}),"undefined"==typeof loadPyodide)throw new Error("Pyodide not loaded. Please include pyodide.js in your HTML.");const t=loadPyodide({indexURL:this.config.pyodideIndexURL});return this.pyodide=await Promise.race([t,this._createTimeoutPromise(this.config.timeout,"Pyodide initialization timeout")]),this.emit("init:progress",{stage:"pyodide",status:"loaded"}),this.config.preloadPackages.length>0&&(this.emit("init:progress",{stage:"packages",packages:this.config.preloadPackages}),await this._loadPackages(this.config.preloadPackages)),this.isReady=!0,this.emit("init:complete",{installedPackages:Array.from(this.installedPackages)}),!0}catch(t){throw this.emit("init:error",{error:t,stage:"initialization"}),t}}async loadPackages(t){if(!this.isReady)throw new Error("Runtime not initialized. Call initialize() first.");return this._loadPackages(t)}async _loadPackages(t){const e=t.filter(t=>!this.installedPackages.has(t));if(0===e.length)return Array.from(this.installedPackages);try{return this.emit("packages:loading",{packages:e}),await this.pyodide.loadPackage(e),e.forEach(t=>this.installedPackages.add(t)),this.emit("packages:loaded",{loaded:e,total:Array.from(this.installedPackages)}),Array.from(this.installedPackages)}catch(t){return this.emit("packages:error",{error:t,packages:e}),e.forEach(t=>this.installedPackages.add(t)),Array.from(this.installedPackages)}}async runPython(t,e={}){if(!this.isReady)throw new Error("Runtime not initialized. Call initialize() first.");const{captureOutput:i=!1,timeout:s=1e3,globals:a={},validateInput:o=!0}=e;if(o&&this._containsDangerousPatterns(t))throw new r("Potentially dangerous code patterns detected");try{const e=[{check:this._needsMatplotlib.bind(this),loader:this._ensureMatplotlibLoaded.bind(this)},{check:this._needsPandas.bind(this),loader:this._ensurePandasLoaded.bind(this)},{check:this._needsScipy.bind(this),loader:this._ensureScipyLoaded.bind(this)},{check:this._needsPlotly.bind(this),loader:this._ensurePlotlyLoaded.bind(this)},{check:this._needsSklearn.bind(this),loader:this._ensureSklearnLoaded.bind(this)}];for(const{check:i,loader:s}of e)i(t)&&await s();for(const[t,e]of Object.entries(a))try{this.pyodide.globals.set(t,e)}catch(e){this.emit("global:error",{key:t,error:e.message})}let r;if(i){const e=`\nimport sys\nfrom io import StringIO\n_output_buffer = StringIO()\n_original_stdout = sys.stdout\nsys.stdout = _output_buffer\n\ntry:\n${t.split("\n").map(t=>"    "+t).join("\n")}\nfinally:\n    sys.stdout = _original_stdout\n    _captured_output = _output_buffer.getvalue()\n`,i=setTimeout(()=>{this.emit("execution:timeout",{timeout:s,stage:"capture_output"})},s);try{await this.pyodide.runPythonAsync(e)}finally{clearTimeout(i)}let a="";try{a=this.pyodide.globals.get("_captured_output")||""}catch(t){this.emit("output:error",{error:t.message}),a="Output capture failed"}r={output:a};try{this.pyodide.globals.delete("_captured_output"),this.pyodide.globals.delete("_output_buffer"),this.pyodide.globals.delete("_original_stdout")}catch(t){this.emit("cleanup:warning",{error:t.message})}}else{const e=setTimeout(()=>{this.emit("execution:timeout",{timeout:s,stage:"capture_output"})},s);try{r=await this.pyodide.runPythonAsync(t)}finally{clearTimeout(e)}}return r}catch(e){throw this.emit("execution:error",{error:e,code:t.substring(0,100)}),e}}getGlobal(t){if(!this.isReady)throw new Error("Runtime not initialized");try{return this.pyodide.globals.get(t)}catch(e){return void this.emit("global:get:error",{name:t,error:e.message})}}setGlobal(t,e){if(!this.isReady)throw new Error("Runtime not initialized");try{this.pyodide.globals.set(t,e)}catch(e){throw this.emit("global:set:error",{name:t,error:e.message}),e}}hasPackage(t){return this.installedPackages.has(t)}getStatus(){return{isReady:this.isReady,installedPackages:Array.from(this.installedPackages),pyodideVersion:this.pyodide?.version||null,config:this.config}}async clearExecutionState(){if(this.isReady)try{await this.pyodide.runPythonAsync("\nimport gc\nimport sys\nimport builtins\n\n# List of globals to preserve (built-ins and essential modules)\npreserved_globals = {\n    'torch', 'np', 'numpy', 'sys', 'builtins', '__builtins__',\n    'gc', '__name__', '__doc__', '__package__', '__loader__',\n    '__spec__', '__annotations__', '__cached__', '__file__'\n}\n\n# Get current globals\ncurrent_globals = list(globals().keys())\n\n# Remove user-defined variables\nfor var_name in current_globals:\n    if (var_name not in preserved_globals and\n        not var_name.startswith('_') and\n        not callable(globals().get(var_name, None)) or\n        var_name.startswith('_greed_')):\n        try:\n            del globals()[var_name]\n        except:\n            pass\n\n# Force garbage collection\ngc.collect()\n")}catch(t){this.emit("state:clear:error",{error:t.message})}}async cleanup(){try{if(this.pyodide){try{await this.pyodide.runPythonAsync("\nimport gc\nimport sys\n\n# Clear user globals\nuser_globals = [k for k in list(globals().keys())\n               if not k.startswith('__') and k not in sys.modules]\nfor k in user_globals:\n    try:\n        del globals()[k]\n    except:\n        pass\n\ngc.collect()\n")}catch(t){}this.pyodide.globals.clear(),this.pyodide=null}this.isReady=!1,this.installedPackages.clear(),this.initPromise=null,this.emit("cleanup:complete")}catch(t){this.emit("cleanup:error",{error:t})}}_createTimeoutPromise(t,e){return new Promise((i,s)=>{setTimeout(()=>s(new Error(e)),t)})}_needsMatplotlib(t){return[/import\s+matplotlib/,/from\s+matplotlib/,/import\s+matplotlib\.pyplot/,/from\s+matplotlib\.pyplot/,/plt\./].some(e=>e.test(t))}async _ensureMatplotlibLoaded(){try{this.installedPackages.has("matplotlib")||(this.emit("package:loading",{package:"matplotlib"}),await this.pyodide.loadPackage("matplotlib"),this.installedPackages.add("matplotlib"),this.emit("package:loaded",{package:"matplotlib"}))}catch(t){this.emit("package:error",{package:"matplotlib",error:t})}}_needsPandas(t){return[/import\s+pandas/,/from\s+pandas/,/import\s+pandas\s+as\s+pd/,/pd\./].some(e=>e.test(t))}async _ensurePandasLoaded(){try{this.installedPackages.has("pandas")||(this.emit("package:loading",{package:"pandas"}),await this.pyodide.loadPackage("pandas"),this.installedPackages.add("pandas"),this.emit("package:loaded",{package:"pandas"}))}catch(t){this.emit("package:error",{package:"pandas",error:t})}}_needsScipy(t){return[/import\s+scipy/,/from\s+scipy/,/scipy\./].some(e=>e.test(t))}async _ensureScipyLoaded(){try{this.installedPackages.has("scipy")||(this.emit("package:loading",{package:"scipy"}),await this.pyodide.loadPackage("scipy"),this.installedPackages.add("scipy"),this.emit("package:loaded",{package:"scipy"}))}catch(t){this.emit("package:error",{package:"scipy",error:t})}}_needsPlotly(t){return[/import\s+plotly/,/from\s+plotly/,/plotly\./,/import\s+plotly\.graph_objects/,/import\s+plotly\.express/].some(e=>e.test(t))}async _ensurePlotlyLoaded(){try{this.installedPackages.has("plotly")||(this.emit("package:loading",{package:"plotly"}),await this.pyodide.loadPackage("plotly"),this.installedPackages.add("plotly"),this.emit("package:loaded",{package:"plotly"}))}catch(t){this.emit("package:error",{package:"plotly",error:t})}}_needsSklearn(t){return[/import\s+sklearn/,/from\s+sklearn/,/sklearn\./,/from\s+sklearn\.\w+/].some(e=>e.test(t))}async _ensureSklearnLoaded(){try{this.installedPackages.has("scikit-learn")||(this.emit("package:loading",{package:"scikit-learn"}),await this.pyodide.loadPackage("scikit-learn"),this.installedPackages.add("scikit-learn"),this.emit("package:loaded",{package:"scikit-learn"}))}catch(t){this.emit("package:error",{package:"scikit-learn",error:t})}}_containsDangerousPatterns(t){return[/\beval\s*\(/,/\bexec\s*\(/,/\b__import__\s*\(/,/\bsubprocess\./,/\bos\.system\s*\(/,/\bopen\s*\(/,/\bfile\s*\(/].some(e=>e.test(t))}}class r extends Error{constructor(t){super(t),this.name="SecurityError"}}const o=a;var n=i(493),l=i(683),c=i(219),h=i(847),m=i(228),d=i(867),u=i(626);class p extends s.A{constructor(t={}){super(),this.config=this._validateConfig({enableWebGPU:!0,enableWorkers:!0,maxWorkers:navigator.hardwareConcurrency||4,strictSecurity:!0,allowEval:!1,allowFileSystem:!1,allowNetwork:!1,maxMemoryMB:1024,gcThreshold:.8,enableProfiling:!0,pyodideIndexURL:"https://cdn.jsdelivr.net/pyodide/v0.24.1/full/",preloadPackages:["numpy"],initTimeout:3e4,...t}),this.isInitialized=!1,this.initializationPromise=null,this.componentsReady={runtime:!1,compute:!1,memory:!1,security:!1},this.runtime=null,this.compute=null,this.memory=null,this.security=null,this.torchAPI=null,this.numpy=null,this.stats={initTime:0,operations:0,totalExecutionTime:0,averageExecutionTime:0,memoryUsage:0,startTime:performance.now()},this.errorCount=0,this.lastError=null,this.run=this.run.bind(this),this._setupGlobalErrorHandling()}async initialize(){return this.initializationPromise||(this.initializationPromise=this._performInitialization()),this.initializationPromise}async _performInitialization(){if(this.isInitialized)return!0;const t=performance.now();this.emit("init:start",{config:this.config});try{return await this._initializeComponents(),await this._setupPyTorchAPI(),await this._validateSystemReadiness(),this.isInitialized=!0,this.stats.initTime=performance.now()-t,this.emit("init:complete",{initTime:this.stats.initTime,components:Object.keys(this.componentsReady).filter(t=>this.componentsReady[t]),memoryUsage:this.memory.getStats().memoryUsageMB}),!0}catch(t){throw this.emit("init:error",{error:t,phase:"initialization"}),this.lastError=t,this.errorCount++,t}}async run(t,e={}){this.isInitialized||await this.initialize();const i=this._generateOperationId(),s=performance.now();this.emit("operation:start",{operationId:i,codeLength:t.length});try{const a=this.security.validatePythonCode(t,{allowWarnings:e.allowWarnings||!1,bypassValidation:e.bypassSecurity||!1});if(!a.allowed)throw new Error(`Security validation failed: ${a.riskLevel} risk detected`);const r=await this.runtime.runPython(t,{captureOutput:!1!==e.captureOutput,timeout:e.timeout||this.config.initTimeout,globals:e.globals||{},validateInput:!1}),o=performance.now()-s;return this._updateOperationStats(o),this.emit("operation:complete",{operationId:i,executionTime:o,securityWarnings:a.warnings?.length||0,memoryUsage:this.memory.getStats().memoryUsageMB}),r}catch(t){const e=performance.now()-s;throw this.emit("operation:error",{operationId:i,error:t,executionTime:e}),this.lastError=t,this.errorCount++,await this._cleanupExecutionState(),t}}async runPython(t,e={}){return this.run(t,e)}async clearState(){if(!this.isInitialized)throw new Error("Greed not initialized. Call initialize() first.");await this._cleanupExecutionState()}async tensor(t,e,i={}){this.isInitialized||await this.initialize();try{this.security.validateTensorData(e,i);const s=this.security.validateOperation(t,i.params,i);return await this.compute.execute(s.operation,e,s.options)}catch(e){throw this.emit("tensor:error",{operation:t,error:e}),this.lastError=e,this.errorCount++,e}}async loadPackages(t){this.isInitialized||await this.initialize();const e=Array.isArray(t)?t:[t],i=this.config.allowedPackages||this.security.config.allowedPackages,s=e.filter(t=>!i.has(t));if(s.length>0)throw new Error(`Packages not in allowlist: ${s.join(", ")}`);return this.runtime.loadPackages(e)}getStats(){const t={...this.stats,isInitialized:this.isInitialized,errorCount:this.errorCount,uptime:performance.now()-this.stats.startTime,components:{...this.componentsReady}};return this.isInitialized?{...t,runtime:this.runtime.getStatus(),compute:this.compute.getStats(),memory:this.memory.getStats(),security:this.security.getStats()}:t}updateConfig(t){const e={...this.config};this.config={...this.config,...t},this.security&&t.security&&this.security.updateConfig(t.security),this.emit("config:updated",{oldConfig:e,newConfig:this.config})}async forceGC(t={}){if(!this.isInitialized)return{cleaned:0};this.emit("gc:start");try{const e=(await Promise.allSettled([this.memory.forceGC(t),this.compute&&this.compute.availableStrategies&&this.compute.availableStrategies.has("webgpu")?this.compute.webgpu.bufferManager?.gc(t):Promise.resolve({destroyed:0})])).reduce((t,e)=>"fulfilled"===e.status?t+(e.value.cleaned||e.value.destroyed||0):t,0);return this.emit("gc:complete",{totalCleaned:e}),{cleaned:e}}catch(t){throw this.emit("gc:error",{error:t}),t}}async _cleanupExecutionState(){try{this.runtime&&this.runtime.isReady&&(await this.runtime.clearExecutionState(),await this.runtime.pyodide.runPythonAsync("\n# Clean up matplotlib state if present\ntry:\n    import matplotlib.pyplot as plt\n    plt.close('all')\n    plt.clf()\n    plt.cla()\nexcept:\n    pass\n\n# Clean up pandas state if present\ntry:\n    import pandas as pd\n    # Clear any cached DataFrames\n    pass\nexcept:\n    pass\n")),this.compute&&this.compute.availableStrategies&&this.compute.availableStrategies.has("webgpu")&&await this.compute.webgpu.bufferManager.forceGC({emergency:!1}),this.memory&&await this.memory.forceGC({targetReduction:.3})}catch(t){console.warn("State cleanup warning:",t.message)}}async reset(){try{return await this.destroy(),this.runtime=null,this.compute=null,this.memory=null,this.security=null,this.torchAPI=null,this.numpy=null,this.tensorBridge=null,this.stats={initTime:0,operations:0,totalExecutionTime:0,averageExecutionTime:0,memoryUsage:0,startTime:performance.now()},this.errorCount=0,this.lastError=null,this.emit("reset:complete"),!0}catch(t){return this.emit("reset:error",{error:t}),!1}}async destroy(){if(this.isInitialized){this.emit("destroy:start");try{await this._cleanupExecutionState();const t=[];this.compute&&t.push(this.compute.cleanup()),this.memory&&t.push(this.memory.cleanup()),this.runtime&&t.push(this.runtime.cleanup()),await Promise.all(t),this.isInitialized=!1,this.initializationPromise=null,this.componentsReady={runtime:!1,compute:!1,memory:!1,security:!1},this.emit("destroy:complete")}catch(t){throw this.emit("destroy:error",{error:t}),t}}}async _initializeComponents(){this.emit("components:init:start"),this.security=new c.A({strictMode:this.config.strictSecurity,allowEval:this.config.allowEval,allowFileSystem:this.config.allowFileSystem,allowNetwork:this.config.allowNetwork,maxTensorSize:this.config.maxTensorSize,maxMemoryMB:this.config.maxMemoryMB}),this.componentsReady.security=!0,this._forwardEvents(this.security,"security"),this.memory=new l.A({maxMemoryMB:this.config.maxMemoryMB,gcThreshold:this.config.gcThreshold,enableAutoGC:!0}),this.componentsReady.memory=!0,this._forwardEvents(this.memory,"memory"),this.runtime=new o({pyodideIndexURL:this.config.pyodideIndexURL,preloadPackages:this.config.preloadPackages,timeout:this.config.initTimeout}),await this.runtime.initialize(),this.componentsReady.runtime=!0,this._forwardEvents(this.runtime,"runtime"),this.compute=new n.A({enableWebGPU:this.config.enableWebGPU,enableWorkers:this.config.enableWorkers,maxWorkers:this.config.maxWorkers,webgpu:{maxBufferSize:1024*this.config.maxMemoryMB*1024*.8,enableProfiling:this.config.enableProfiling}});try{const t=await this.compute.initialize();this.componentsReady.compute=!0,this._forwardEvents(this.compute,"compute"),u.A.debug("Compute strategies initialized:",{availableStrategies:Array.from(t||[]),hasWebGPU:t?.has("webgpu")??!1})}catch(t){u.A.error("Compute strategy initialization failed:",t),this.componentsReady.compute=!0,this._forwardEvents(this.compute,"compute")}this.emit("components:init:complete",{components:Object.keys(this.componentsReady).filter(t=>this.componentsReady[t])})}async _setupPyTorchAPI(){this.emit("pytorch:setup:start");try{console.log("[WebGPU Debug] Greed initialization - checking WebGPU availability"),console.log("[WebGPU Debug] this.compute:",this.compute?"present":"null"),this.compute&&(console.log("[WebGPU Debug] this.compute.availableStrategies:",this.compute.availableStrategies?"present":"null"),this.compute.availableStrategies&&(console.log("[WebGPU Debug] Available strategies:",Array.from(this.compute.availableStrategies)),console.log("[WebGPU Debug] Has webgpu strategy:",this.compute.availableStrategies.has("webgpu")))),this.compute&&this.compute.availableStrategies&&this.compute.availableStrategies.has("webgpu")?(console.log("[WebGPU Debug] WebGPU strategy available, setting up tensor integration"),h.O.setComputeEngine(this.compute.webgpu),console.log("[WebGPU Debug] Calling createTensorBridge..."),this.tensorBridge=(0,m.nn)(this.compute.webgpu),console.log("[WebGPU Debug] TensorBridge created and stored in this.tensorBridge")):console.log("[WebGPU Debug] WebGPU strategy NOT available - bridge will not be created"),u.A.debug("Ensuring numpy is loaded before PyTorch polyfill installation");try{await this.runtime.loadPackages(["numpy"]),u.A.debug("Numpy loading completed successfully")}catch(t){throw u.A.error("Failed to load numpy:",t),t}u.A.debug("Checking if PyTorch polyfill is already installed");const t=await this.runtime.runPython('\ntry:\n    import torch\n    print("PyTorch polyfill already installed")\n    _polyfill_installed = True\nexcept ImportError:\n    print("PyTorch polyfill not found, installing...")\n    _polyfill_installed = False\n',{captureOutput:!0});if(t.output&&t.output.includes("already installed"))u.A.debug("PyTorch polyfill already installed, skipping re-installation");else{const t=(0,d.pH)();(0,d.EH)(t),u.A.debug("Installing PyTorch polyfill from extracted module"),await this.runtime.runPython(t,{captureOutput:!1,validateInput:!1})}this.torchAPI=this.runtime.getGlobal("torch"),this.numpy=this.runtime.getGlobal("np"),this.emit("pytorch:setup:complete")}catch(t){throw this.emit("pytorch:setup:error",{error:t}),new Error(`PyTorch API setup failed: ${t.message}`)}}async _validateSystemReadiness(){this.emit("validation:start");const t=[{name:"runtime",check:()=>this.runtime.isReady},{name:"compute",check:()=>this.compute&&this.compute.isInitialized},{name:"memory",check:()=>this.memory.getStats().memoryUsage>=0},{name:"security",check:()=>this.security.getStats().totalValidations>=0},{name:"pytorch",check:()=>null!==this.torchAPI}],e=[];for(const{name:i,check:s}of t)try{const t=s();if(e.push({name:i,passed:t,error:null}),!t)throw new Error(`${i} component failed readiness check`)}catch(t){throw e.push({name:i,passed:!1,error:t.message}),new Error(`System validation failed for ${i}: ${t.message}`)}this.emit("validation:complete",{results:e})}_validateConfig(t){const e=["pyodideIndexURL","maxMemoryMB"];for(const i of e)if(void 0===t[i])throw new Error(`Required configuration missing: ${i}`);if(t.maxMemoryMB<=0||t.maxMemoryMB>4096)throw new Error(`maxMemoryMB must be between 1 and 4096, got ${t.maxMemoryMB}`);return t}_forwardEvents(t,e){const i=["error","warning","init:complete","init:error","cleanup:complete","cleanup:error"];for(const s of i)t.on(s,t=>{this.emit(`${e}:${s}`,t)})}_setupGlobalErrorHandling(){this.on("error",t=>{this.lastError=t,this.errorCount++});const t=["security:error","memory:error","runtime:error","compute:error"];for(const e of t)this.on(e,t=>{this.emit("error",new Error(`${e}: ${t.error?.message||"Unknown error"}`))})}_updateOperationStats(t){this.stats.operations++,this.stats.totalExecutionTime+=t,this.stats.averageExecutionTime=this.stats.totalExecutionTime/this.stats.operations,this.memory&&(this.stats.memoryUsage=this.memory.getStats().memoryUsageMB)}_generateOperationId(){return`greed_op_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}const y=p}}]);